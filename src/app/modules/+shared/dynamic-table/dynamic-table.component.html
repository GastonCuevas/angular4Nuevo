<div class="row">
  <span class="card-title">{{title}}</span>
  <loading *ngIf="isLoading"></loading>

  <app-dynamic-filter *ngIf="controlsToFilter"
    [show]="!isLoading"
    [(controls)]="controlsToFilter"
    [withSubmit]="filterWithSubmit"
    (invalidFilter)="updateLoading($event)"
    (filterChange)="onFilterChange($event)">
  </app-dynamic-filter>

  <div class="container-table">
    <table class="highlight table-sortable" *ngIf="!isLoading" id="table">
      <a class="btn-floating btn-small waves-effect waves-light" (click)="onActionClick('new')" style="top: 37px;" *ngIf="!disabledNew && !hideActions">
        <i class="fa fa-plus" style="color: white;"></i>
      </a>

      <thead>
        <tr>
          <th *ngFor="let column of columns" [ngSwitch]="column.type" [class]="selectedClass(column)" (click)="changeSorting(column)" [style.width]="column.width">
            <ng-container *ngSwitchCase="'checkbox'">
              <span style="padding-right: 8px; margin-left: -15px;">{{column.header}}</span>
              <input type="checkbox" [id]="column.property" [checked]="objectToCheckbox[column.property]" (change)="selectAll(column, $event.target.checked, sourceData)" />
              <label [attr.for]="column.property" style="position: absolute;"></label>
            </ng-container>
            <ng-container *ngSwitchDefault>
              {{column.header}}
            </ng-container>
          </th>
          <th *ngIf="showActions() && !hideActions" class="text-center column-actions">
            Acciones
          </th>
          <th *ngIf="showSelected" class="text-center">
            <div class="switch">
              <label>
                <input type="checkbox" class="filled-in" id="checkbox-selected-all" (change)="onAllSelect($event.target.checked)" />
                <span class="lever"></span>
              </label>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngIf="showFilters() && !controlsToFilter && !hideFilters" class="filter">
          <td *ngFor="let c of columns" [ngSwitch]="c.elementFilter?.typeFilter">
            <div *ngSwitchCase="'number'">
              <input [type]="c.elementFilter?.typeFilter" *ngIf="containsFilter(c)" (keyup)="changeInput($event,c.property)">
            </div>
            <div *ngSwitchCase="'text'">
              <input [type]="c.elementFilter?.typeFilter" *ngIf="containsFilter(c)" (keyup)="changeInput($event,c.property)">
            </div>
            <div *ngSwitchCase="'name'">
                <input *ngIf="containsFilter(c)" (keyup)="changeInput($event,c.property)">
            </div>  
            <div *ngSwitchCase="'date'">
              <input *ngIf="c.property == 'dateFrom'" id="{{c.property}}" [type]="c.elementFilter?.typeFilter" class="datepicker" materialize="pickadate"
                [materializeParams]="[fromDateOptions]" />
              <input *ngIf="c.property == 'dateTo'" id="{{c.property}}" [type]="c.elementFilter?.typeFilter" class="datepicker" materialize="pickadate"
                [materializeParams]="[toDateOptions]" />
              <input *ngIf="c.property == 'birthdate'" id="{{c.property}}" [type]="c.elementFilter?.typeFilter" class="datepicker" materialize="pickadate"
                [materializeParams]="[birthDateOptions]" />
              <input *ngIf="c.property == 'date'" id="{{c.property}}" [type]="c.elementFilter?.typeFilter" class="datepicker" materialize="pickadate"
                [materializeParams]="[dateOptions]" />
              <input *ngIf="c.property == 'admissionDate'" id="{{c.property}}" [type]="c.elementFilter?.typeFilter" class="datepicker"
                materialize="pickadate" [materializeParams]="[admissionDateOptions]" />
            </div>
          </td>
        </tr>
        <tr>
          <td  class="center-align progress-loading" [attr.colspan]="columns.length + 1">
            <div *ngIf="isFiltering"  class="progress">
              <div class="indeterminate"></div>
            </div>
          </td>
        </tr>
        <tr *ngIf="sourceData.length <= 0 && !isFiltering">
          <td  [attr.colspan]="columns.length + 1"><p class="text-center">No hay elementos para mostrar.</p> </td>
        </tr>
        <tr *ngFor="let data of sourceData, let i = index" (click)="select(i, data)" [style.background]="i === currentRow && selectedEnabled ? '#47bff58a' : ''">
          <td *ngFor="let column of columns" [ngSwitch]="column.type" [style.max-width]="column.width" [class]="column.classes" [style.white-space]="column.type == 'button' ? 'nowrap' : ''">
            <span *ngSwitchCase="'checkbox'">
              <ng-container *ngIf="column.hideColumnBy ? !data[column.hideColumnBy] : true">
                <!-- <input type="checkbox" class="filled-in" id="checkbox-{{ getPropByString(data, column.idProperty) }}" [checked]="getPropByString(data, column.property)"
                  (change)="onCheckboxChange(data, $event.target.checked)" disabled/>
                <label for="checkbox-{{ getPropByString(data, column.idProperty) }}"></label> -->
                <span style="padding-right: 8px; margin-left: -15px;"></span>
                <input type="checkbox" [id]="column.property + '-' + i" [class]="'checkbox-' + column.property" (change)="onCheckboxChange(data, column, $event.target.checked)"
                  [checked]="data[column.property]" [disabled]="column.disabled"/>
                <label [attr.for]="column.property + '-' + i" style="position: absolute;"></label>
              </ng-container>
              <ng-container *ngIf="column.hideColumnBy && column.defaultValue ? data[column.hideColumnBy] : false">
                {{column.defaultValue}}
              </ng-container>
            </span>
            <span *ngSwitchCase="'date'">
              {{getPropByString(data, column.property) | date:'dd/MM/yyyy'}}
            </span>
            <ng-container *ngSwitchCase="'button'">
              <ng-container *ngIf="column.propHideBtns ? !data[column.propHideBtns] : true ">
                <ng-container *ngFor="let btn of column.btns">
                  <button *ngIf="btn.propHide ? !data[btn.propHide] : true " type="button" class="waves-effect waves-light btn button-small {{btn.color}}"
                  materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="btn.tooltip || btn.label"
                  (click)="onActionClick(btn.action, data)">
                    {{btn.label}}
                  </button>
                </ng-container>
              </ng-container>
            </ng-container>
            <span *ngSwitchDefault>
              {{getPropByString(data, column.property)}}
              <!-- {{data[column.property][column.subProperty]}} -->
            </span>
          </td>
          <td class="text-center" [style.white-space]="'nowrap'" *ngIf="!data.action && !hideActions">
            <a (click)="onActionClick('edit', data)" materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="getTextTooltip('edit')"
              *ngIf="!disabledEdit">
              <i [class]="getTextIcon('edit')"></i>
            </a>
            <a (click)="onActionClick('delete', data)" materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="getTextTooltip('delete')"
              *ngIf="!disabledDelete">
              <i [class]="getTextIcon('delete')"></i>
            </a>
            <a (click)="onActionClick('detail', data)" materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="getTextTooltip('detail')"
              *ngIf="!disabledDetail">
              <i [class]="getTextIcon('detail')"></i>
            </a>
            <a (click)="onActionClick('copy', data)" materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="getTextTooltip('copy')"
              *ngIf="enabledClone">
              <i [class]="getTextIcon('copy')"></i>
            </a>
            <a (click)="onActionClick('print', data)" materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="getTextTooltip('print')"
              *ngIf="enabledPrint">
              <i [class]="getTextIcon('print')"></i>
            </a>
            <a (click)="onActionClick('exportXml', data)" materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="getTextTooltip('exportXml')"
              *ngIf="enableExportXml">
              <i [class]="getTextIcon('exportXml')"></i>
            </a>
            <a (click)="onActionClick('exportJson', data)" materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="getTextTooltip('exportJson')"
              *ngIf="enableExportJson">
              <i [class]="getTextIcon('exportJson')"></i>
            </a>
          </td>
          <td class="text-center" *ngIf="data.action">
            <a (click)="onActionClick('edit', data)" materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="getTextTooltip('edit')"
              *ngIf="!disabledEdit && data.action.edit">
              <i [class]="getTextIcon('edit')"></i>
            </a>
            <a (click)="onActionClick('delete', data)" materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="getTextTooltip('delete')"
              *ngIf="data.action.delete">
              <i [class]="getTextIcon('delete')"></i>
            </a>
            <a (click)="onActionClick('detail', data)" materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="getTextTooltip('detail')"
              *ngIf="!disabledDetail && data.action.detail">
              <i [class]="getTextIcon('detail')"></i>
            </a>
            <a (click)="onActionClick('copy', data)" materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="getTextTooltip('copy')"
              *ngIf="enabledClone">
              <i [class]="getTextIcon('copy')"></i>
            </a>
            <a (click)="onActionClick('obs', data)" materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="getTextTooltip('obs')"
              *ngIf="!disabledObs && data.action.observation">
              <i [class]="getTextIcon('obs')"></i>
            </a>
            <a (click)="onActionClick('print', data)" materialize="tooltip" data-position="bottom" data-delay="50" [attr.data-tooltip]="getTextTooltip('print')"
              *ngIf="enabledPrint">
              <i [class]="getTextIcon('print')"></i>
            </a>
          </td>
          
          <td *ngIf="showSelected" class="text-center">
            <div class="switch">
              <label>
                <input type="checkbox" class="filled-in checkbox-selected-item" id="checkbox-selected-item" (change)="onItemSelect(data, $event.target.checked)"
                  [checked]="data.selected" [value]="data.selected"/>
                <span class="lever"></span>
              </label>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

</div>

<div class="row" *ngIf="!isLoading">
  <div class="input-field left" *ngIf="paginator.totalItems > 10">
    <select materialize="material_select" [(ngModel)]="paginator.pageSize" (change)="selectPageSize()">
      <option value="10">10</option>
      <option value="20">20</option>
      <option value="50">50</option>
      <option value="100">100</option>
    </select>
    <label>Mostrar</label>
  </div>

  <ul class="pagination right" *ngIf="paginator.totalItems > paginator.pageSize && !isLoading">
    <li [class.disabled]="paginator.currentPage == 1" [class.waves-effect]="paginator.currentPage != 1">
      <a (click)="previousPage()">
        <i class="material-icons">chevron_left</i>
      </a>
    </li>

    <span *ngFor="let page of pages">
      <li [class.active]="page == paginator.currentPage" class="waves-effect" *ngIf="paginator.currentPage - adjacentPagesCount > 1 && page == 1">
        <a (click)="selectPage(page)">{{page}}</a>
      </li>
      <li *ngIf="paginator.currentPage - adjacentPagesCount > 1 && page == 1">
        <a>...</a>
      </li>
      <li [class.active]="page == paginator.currentPage" class="waves-effect" *ngIf="page >= paginator.currentPage - adjacentPagesCount && page <= paginator.currentPage + adjacentPagesCount">
        <a (click)="selectPage(page)">{{page}}</a>
      </li>
      <li *ngIf="paginator.currentPage + adjacentPagesCount < pages.length && page == pages.length">
        <a>...</a>
      </li>
      <li [class.active]="page == paginator.currentPage" class="waves-effect" *ngIf="paginator.currentPage + adjacentPagesCount < pages.length && page == pages.length">
        <a (click)="selectPage(page)">{{page}}</a>
      </li>
    </span>



    <li [class.disabled]="paginator.currentPage == pages.length" [class.waves-effect]="paginator.currentPage != pages.length">
      <a (click)="nextPage()">
        <i class="material-icons">chevron_right</i>
      </a>
    </li>
  </ul>
</div>

<app-button-floating *ngIf="!disableButtonFloating"></app-button-floating>